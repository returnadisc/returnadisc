{% extends "base.html" %}

{% block title %}Hantera Premium - ReturnADisc{% endblock %}

{% block extra_css %}
<style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    .manage-hero { min-height: 100vh; position: relative; overflow: hidden; display: flex; align-items: center; justify-content: center; padding: 100px 20px 40px; background: linear-gradient(135deg, #166534 0%, #0d3320 100%); }
    .manage-bg { position: absolute; top: 0; left: 0; width: 100%; height: 120%; background-size: cover; background-position: center; animation: panImage 20s ease-in-out infinite alternate; }
    @keyframes panImage { 0% { transform: scale(1.1) translate(0, 0); } 100% { transform: scale(1.1) translate(1%, -2%); } }
    .manage-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.7)); z-index: 1; }
    .manage-content { position: relative; z-index: 2; width: 100%; max-width: 600px; }
    .manage-header { text-align: center; color: white; margin-bottom: 30px; }
    .manage-icon { width: 80px; height: 80px; background: linear-gradient(145deg, #fbbf24 0%, #f59e0b 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px; font-size: 2.5rem; box-shadow: 0 15px 40px rgba(251, 191, 36, 0.4); }
    .manage-header h1 { color: white; font-size: 2.2rem; font-weight: 700; margin-bottom: 8px; }
    .manage-tagline { color: rgba(255, 255, 255, 0.9); font-size: 1.1rem; }
    .manage-card { background: rgba(245, 245, 220, 0.98); border-radius: 24px; padding: 35px; box-shadow: 0 25px 60px rgba(0, 0, 0, 0.3); }
    .manage-card h2 { color: #1f2937; font-size: 1.6rem; margin-bottom: 25px; text-align: center; }
    .status-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 25px; }
    .status-item { background: white; padding: 25px 20px; border-radius: 16px; text-align: center; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05); border: 2px solid transparent; }
    .status-item.active { border-color: #22c55e; }
    .status-item.cancelled { border-color: #ef4444; }
    .status-item.pending { border-color: #fbbf24; }
    .status-item label { display: block; color: #6b7280; font-size: 0.8rem; text-transform: uppercase; margin-bottom: 10px; font-weight: 600; }
    .status-item value { display: block; color: #166534; font-size: 1.4rem; font-weight: 700; }
    .status-item.cancelled value { color: #dc2626; }
    .status-item.pending value { color: #f59e0b; }
    .launch-offer-box { background: linear-gradient(145deg, #fef3c7 0%, #fde68a 100%); border-radius: 16px; padding: 25px; margin-bottom: 25px; text-align: center; color: #92400e; border: 2px solid #fbbf24; }
    .launch-offer-box h3 { font-size: 1.2rem; margin-bottom: 12px; color: #78350f; }
    .launch-offer-box p { font-size: 1rem; line-height: 1.6; margin: 0; }
    .cancel-section { border-top: 1px solid #e5e7eb; padding-top: 25px; margin-top: 25px; }
    .cancel-section h3 { color: #374151; margin-bottom: 10px; }
    .cancel-section p { color: #6b7280; margin-bottom: 20px; }
    .btn-cancel { background: #fee2e2; color: #dc2626; padding: 12px 24px; border: 2px solid #dc2626; border-radius: 8px; font-weight: 600; cursor: pointer; }
    .btn-cancel:hover { background: #fecaca; }
    .btn-reactivate { background: #d1fae5; color: #065f46; padding: 12px 24px; border: 2px solid #065f46; border-radius: 8px; font-weight: 600; cursor: pointer; }
    .btn-reactivate:hover { background: #a7f3d0; }
    .pending-info { background: #fef3c7; color: #92400e; padding: 20px; border-radius: 12px; text-align: center; margin-top: 20px; border: 2px solid #fbbf24; }
    .cancelled-info { background: #d1fae5; color: #065f46; padding: 20px; border-radius: 12px; text-align: center; margin-top: 20px; }
    .back-section { margin-top: 25px; text-align: center; }
    .btn-back { display: inline-flex; align-items: center; gap: 10px; background: transparent; color: white; padding: 12px 24px; border-radius: 50px; text-decoration: none; font-weight: 500; border: 2px solid rgba(255, 255, 255, 0.5); }
    @media (max-width: 480px) { .status-grid { grid-template-columns: 1fr; } }
</style>
{% endblock %}

{% block content %}
<section class="manage-hero">
    <div class="manage-bg" style="background-image: url('{{ url_for('static', filename='images/hero-bg.png') }}');"></div>
    <div class="manage-overlay"></div>
    
    <div class="manage-content">
        <div class="manage-header">
            <div class="manage-icon">üíé</div>
            <h1>Din prenumeration</h1>
            <p class="manage-tagline">Hantera ditt ReturnaDisc Premium</p>
        </div>

        <div class="manage-card">
            <h2>Prenumerationsdetaljer</h2>
            
            {% set subscription = premium_status.active_subscription %}
            {% set is_cancelled = subscription and subscription.status == 'cancelled' %}
            {% set will_cancel = subscription and (subscription.cancel_at_period_end == True or subscription.cancel_at_period_end == 1 or subscription.cancel_at_period_end == 't') %}
            
            <div class="status-grid">
                <div class="status-item {% if is_cancelled %}cancelled{% elif will_cancel %}pending{% else %}active{% endif %}">
                    <label>Status</label>
                    <value>
                        {% if is_cancelled %}Avbruten
                        {% elif will_cancel %}Avbryts snart
                        {% else %}Aktiv{% endif %}
                    </value>
                </div>
                <div class="status-item">
                    <label>Giltig till</label>
                    <value>{% if premium_status.premium_until %}{{ premium_status.premium_until.strftime('%Y-%m-%d') }}{% else %}2027-03-01{% endif %}</value>
                </div>
            </div>
            
            {% if subscription and subscription.is_launch_offer and not is_cancelled %}
            <div class="launch-offer-box">
                <h3>üéâ Du har lanseringserbjudandet!</h3>
                <p>Ditt premium √§r <strong>helt gratis</strong> till 1 mars 2027. Efter det dras 39 kr/√•r automatiskt.</p>
            </div>
            {% endif %}
            
            {% if not is_cancelled %}
                {% if will_cancel %}
                <div class="pending-info">
                    <p>‚ö†Ô∏è Din prenumeration avbryts vid periodens slut ({{ premium_status.premium_until.strftime('%Y-%m-%d') }}).</p>
                    <form action="{{ url_for('premium.reactivate') }}" method="POST" style="margin-top: 15px;">
                        <button type="submit" class="btn-reactivate">√Öteraktivera prenumeration</button>
                    </form>
                </div>
                {% else %}
                <div class="cancel-section">
                    <h3>Avbryt prenumeration</h3>
                    <p>Du kan avbryta n√§r som helst. Du beh√•ller premium till periodens slut.</p>
                    <form action="{{ url_for('premium.cancel') }}" method="POST" 
                          onsubmit="return confirm('√Ñr du s√§ker? Du beh√•ller premium till {{ premium_status.premium_until.strftime('%Y-%m-%d') }}.');">
                        <button type="submit" class="btn-cancel">Avbryt prenumeration</button>
                    </form>
                </div>
                {% endif %}
            {% else %}
            <div class="cancelled-info">
                <p>‚úì Din prenumeration √§r avbruten.</p>
            </div>
            {% endif %}
        </div>
        
        <div class="back-section">
            <a href="{{ url_for('disc.dashboard') }}" class="btn-back">‚Üê Tillbaka till Dashboard</a>
        </div>
    </div>
</section>
{% endblock %}